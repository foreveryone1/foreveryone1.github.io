"use strict";const JSON_URL="data/renderdemo.json",STORAGE_LOCATION="demoInput";window.onload=pLoadJson;async function pLoadJson(){const a=await StorageUtil.pGetForPage("renderer");ExcludeUtil.pInitialise(),BrewUtil.pAddBrewData();const b=await DataUtil.loadJSON(JSON_URL);return initDemo(b,a)}async function initDemo(a,b){function c(a){switch(a){case"html":{g=Renderer.get(),j.removeClass("whitespace-pre");break}case"md":{g=RendererMarkdown.get(),j.addClass("whitespace-pre");break}case"cards":{g=RendererCard.get(),j.addClass("whitespace-pre");break}default:throw new Error(`Unhandled renderer!`);}}function d(){h.html("");const a=[];let b;try{b=JSON.parse(n.getValue())}catch(a){h.html(`Invalid JSON! We recommend using <a href="https://jsonlint.com/" target="_blank" rel="noopener noreferrer">JSONLint</a>.`),setTimeout(()=>{throw a})}g.setFirstSection(!0),g.resetHeaderIndex(),g.recursiveRender(b,a),j.html(`
			<tr><th class="border" colspan="6"></th></tr>
			<tr class="text"><td colspan="6">${a.join("")}</td></tr>
			<tr><th class="border" colspan="6"></th></tr>
		`)}function e(){n.setValue(JSON.stringify(f,null,"\t")),n.clearSelection(),d(),n.selection.moveCursorToPosition({row:0,column:0})}const f=a.data[0];let g;const h=$(`#message`),i=$(`#jsoninput`),j=$(`#pagecontent`),k=$(`#demoSelectRenderer`),l=$(`#demoRender`),m=$(`#demoReset`);c(b||"html"),k.val(b||"html");const n=ace.edit("jsoninput");n.setOptions({wrap:!0,showPrintMargin:!1,tabSize:2});try{const a=await StorageUtil.pGetForPage(STORAGE_LOCATION);a?(n.setValue(a,-1),d()):e()}catch(a){setTimeout(()=>{throw a}),e()}const o=MiscUtil.debounce(()=>{d(),StorageUtil.pSetForPage(STORAGE_LOCATION,n.getValue())},150);k.change(()=>{const a=k.val();c(a),d(),StorageUtil.pSetForPage("renderer",a)}),m.click(()=>e()),l.click(()=>d()),n.on("change",()=>o()),window.dispatchEvent(new Event("toolsLoaded"))}
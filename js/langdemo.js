import{Ro_Lexer,Ro_Parser,Ro_Lang}from"./rolang.js";class LangDemoUi{static init(){$(`#btn__run`).click(()=>LangDemoUi.pRun()),$(`#btn__validate`).click(async()=>{const a=await Ro_Lang.pValidate(LangDemoUi._$ipt.val(),LangDemoUi.RESOLVER);LangDemoUi._handleInvalidMessage(a)}),$(`#btn__resolve_dynamics`).click(async()=>{const a=await Ro_Lang.pResolveDynamics(LangDemoUi._$ipt.val(),LangDemoUi.RESOLVER);LangDemoUi._$ipt.val(a)}),$(`#btn__validate_dynamics`).click(async()=>{const a=await Ro_Lang.pValidateDynamics(LangDemoUi._$ipt.val(),LangDemoUi.RESOLVER);LangDemoUi._handleInvalidMessage(a)});const a=$(`#sel__sample`);LangDemoUi._SAMPLES.forEach((b,c)=>{a.append(`<option value="${c}">${b.name}</option>`)}),a.change(()=>{const b=LangDemoUi._SAMPLES[a.val()];LangDemoUi._$ipt.val(b.code).change()}),a.val("-1"),LangDemoUi._$ipt=$(`#ipt`),LangDemoUi._$ipt.change(()=>{StorageUtil.syncSetForPage("input",LangDemoUi._$ipt.val())});const b=StorageUtil.syncGetForPage("input");b&&b.trim()&&LangDemoUi._$ipt.val(b.trim());const c=()=>{const a=LangDemoUi._metasContext.map(a=>({name:a.$iptName.val(),val:a.$iptVal.val()}));StorageUtil.syncSetForPage("context",a)},d=(a,b)=>{const d=$(`<input class="form-control form-control--minimal input-xs mr-2 code" placeholder="Identifier">`).change(()=>c()).val(a),e=$(`<input class="form-control form-control--minimal input-xs mr-2 code" type="number" placeholder="Value">`).change(()=>c()).val(b),f=$(`<button class="btn btn-xs btn-danger" tabindex="-1"><span class="glyphicon glyphicon-trash"/></button>`).click(()=>{const a=LangDemoUi._metasContext.indexOf(g);~a&&(LangDemoUi._metasContext.splice(a,1),h.remove(),c())}),g={$iptName:d,$iptVal:e};LangDemoUi._metasContext.push(g);const h=$$`<div class="mb-2 flex-v-center">${d}<span class="mr-2">=</span>${e}${f}</div>`.appendTo(LangDemoUi._$wrpContext)};LangDemoUi._$wrpContext=$(`#wrp_context`);const e=$(`<button class="btn btn-xs btn-default">Add Context</button>`).click(()=>d());$$`<div class="mb-2 flex-v-center">${e}</div>`.appendTo(LangDemoUi._$wrpContext),(()=>{const a=StorageUtil.syncGetForPage("context");null!=a&&a.forEach(a=>d(a.name,a.val))})(),window.dispatchEvent(new Event("toolsLoaded"))}static _handleInvalidMessage(a){a?JqueryUtil.doToast({content:`Invalid \u2014 ${a}`,type:"danger"}):JqueryUtil.doToast({content:`Valid!`,type:"success"})}static async pRun(){const a=LangDemoUi._$ipt.val().trim(),b=await Ro_Lang.pValidate(a,LangDemoUi.RESOLVER);b&&LangDemoUi._handleInvalidMessage(b);const c=$(`#out_lexed`).html(""),d=$(`#out_parsed`).html(""),e=$(`#out_result`).html(""),f=new Ro_Lexer,g=f.lex(a);c.html(g.map(a=>a?a.toDebugString():"").join("\n"));const h=new Ro_Parser(g),i=h.parse();d.html(`${i}`);const j=LangDemoUi._metasContext.mergeMap(a=>({[a.$iptName.val().trim()]:+a.$iptVal.val()||0})),k=await i.pEvl(j,LangDemoUi.RESOLVER);k.isCancelled?e.text("Cancelled!"):e.text(null==k.val?`(null)`:k.val)}}LangDemoUi._$ipt=null,LangDemoUi._$wrpContext=null,LangDemoUi._metasContext=[],LangDemoUi._SAMPLES=[{name:"Empty",code:`



`},{name:"Number",code:`1`},{name:"Sum",code:`1 + 1`},{name:"Multiplication",code:`2 * 3`},{name:"Exponent",code:`3^3^2  # Should equal 19683`},{name:"If-elif-else",code:`if r == 20: 1
elif r > 1:
  2
else:
  3
4`},{name:"If-elif",code:`if r == 20: 1
elif r > 1:
  2`},{name:"If-else",code:`if r == 20: 1
else:
  2`},{name:"If",code:`if r == 20: 1`},{name:"If (trailing return)",code:`if r == 20: 1
2`},{name:"Condition Negation",code:`if not r: 2`},{name:"Parentheses",code:`(2 + 3) * 4  # Should equal 20`},{name:"Dynamic Int",code:`if @user_int > 10: 2`},{name:"Labelled Dynamic Int",code:`if (@user_int|Enter: a /*+-^,!= (Number)) > 10: 2`},{name:"Selectable Dynamic Int",code:`if (@user_int|| 1 = One Apple| 2 = Two Bananas |3|4|11=11 Oranges) > 10: 2`},{name:"Dynamic Bool",code:`if not @user_bool: 3`},{name:"Labelled Dynamic Bool",code:`if not (@user_bool|Choose: /*+-^,!= (Yes\\No)): 4`},{name:"Custom Buttons Dynamic Bool",code:`if (@user_bool||Good | Evil): 2`},{name:"Selectable Dynamic Bool",code:`if not (@user_bool|Pick| true = Good| false = Evil |true|false|true=Lawful): 2`}],LangDemoUi.RESOLVER={has:()=>!0,get:a=>{var b=Math.round;const c=b(50*Math.random());return JqueryUtil.doToast(`Randomized ${a} as ${c}`),c}},window.addEventListener("load",()=>LangDemoUi.init());
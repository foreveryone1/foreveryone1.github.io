"use strict";class ListPage{constructor(a){this._dataSource=a.dataSource,this._dataSourcefluff=a.dataSourceFluff,this._filters=a.filters,this._filterSource=a.filterSource,this._pageFilter=a.pageFilter,this._listClass=a.listClass,this._listOptions=a.listOptions||{},this._sublistClass=a.sublistClass,this._sublistOptions=a.sublistOptions||{},this._dataProps=a.dataProps,this._bookViewOptions=a.bookViewOptions,this._tableViewOptions=a.tableViewOptions,this._hasAudio=a.hasAudio,this._renderer=Renderer.get(),this._list=null,this._listSub=null,this._filterBox=null,this._dataList=[],this._ixData=0,this._bookView=null}async pOnLoad(){await ExcludeUtil.pInitialise();const a="string"==typeof this._dataSource?await DataUtil.loadJSON(this._dataSource):await this._dataSource();this._list=ListUtil.initList({$wrpList:$(`ul.list.${this._listClass}`),...this._listOptions}),ListUtil.setOptions({primaryLists:[this._list]}),SortUtil.initBtnSortHandlers($("#filtertools"),this._list),this._filterBox=this._pageFilter?await this._pageFilter.pInitFilterBox({$iptSearch:$(`#lst__search`),$wrpFormTop:$(`#filter-search-input-group`).title("Hotkey: f"),$btnReset:$(`#reset`)}):await pInitFilterBox({filters:this._filters});const b=$(`.lst__wrp-search-visible`);this._list.on("updated",()=>b.html(`${this._list.visibleItems.length}/${this._list.items.length}`)),$(this._filterBox).on(FilterBox.EVNT_VALCHANGE,this.handleFilterChange.bind(this)),this._listSub=ListUtil.initSublist({listClass:this._sublistClass,getSublistRow:this.getSublistItem.bind(this),...this._sublistOptions}),ListUtil.initGenericPinnable(),SortUtil.initBtnSortHandlers($("#sublistsort"),this._listSub),this._addData(a),BrewUtil.bind({filterBox:this._filterBox,sourceFilter:this._pageFilter?this._pageFilter.sourceFilter:this._filterSource,list:this._list,pHandleBrew:async a=>this._addData(a)});const c=await BrewUtil.pAddBrewData();await this._pHandleBrew(c),await BrewUtil.pAddLocalBrewData(),BrewUtil.makeBrewButton("manage-brew"),await ListUtil.pLoadState(),RollerUtil.addListRollButton(),ListUtil.addListShowHide(),this._hasAudio&&Renderer.utils.bindPronounceButtons(),this._bookViewOptions&&(this._bookView=new BookModeView({hashKey:"bookview",$openBtn:this._bookViewOptions.$btnOpen,noneVisibleMsg:this._bookViewOptions.noneVisibleMsg,pageTitle:this._bookViewOptions.pageTitle||"Book View",popTblGetNumShown:this._bookViewOptions.popTblGetNumShown,hasPrintColumns:!0})),window.loadHash=this.doLoadHash.bind(this),window.loadSubHash=this.pDoLoadSubHash.bind(this),this._list.init(),this._listSub.init(),Hist.init(!0),ExcludeUtil.checkShowAllExcluded(this._dataList,$(`#pagecontent`)),window.dispatchEvent(new Event("toolsLoaded"))}async _pHandleBrew(a){try{this._addData(a)}catch(a){BrewUtil.pPurgeBrew(a)}}_addData(a){if(this._dataProps.some(b=>a[b]&&a[b].length)){this._dataProps.forEach(b=>{a[b].forEach(a=>a.__prop=b),this._dataList.push(...a[b])});for(const a=this._dataList.length;this._ixData<a;this._ixData++){const a=this._dataList[this._ixData],b=ExcludeUtil.isExcluded(a.name,a.__prop,a.source);this._list.addItem(this.getListItem(a,this._ixData,b))}this._list.update(),this._filterBox.render(),this.handleFilterChange(),ListUtil.setOptions({itemList:this._dataList,primaryLists:[this._list]}),ListUtil.bindPinButton(),Renderer.hover.bindPopoutButton(this._dataList),UrlUtil.bindLinkExportButton(this._filterBox),ListUtil.bindDownloadButton(),ListUtil.bindUploadButton(),this._tableViewOptions&&ListUtil.bindShowTableButton("btn-show-table",this._tableViewOptions.title,this._dataList,this._tableViewOptions.colTransforms,this._tableViewOptions.filter,this._tableViewOptions.sorter)}}getListItem(){throw new Error(`Unimplemented!`)}handleFilterChange(){throw new Error(`Unimplemented!`)}getSublistItem(){throw new Error(`Unimplemented!`)}doLoadHash(){throw new Error(`Unimplemented!`)}pDoLoadSubHash(){throw new Error(`Unimplemented!`)}}
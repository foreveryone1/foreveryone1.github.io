class ListItem{constructor(a,b,c,d,e){this.ix=a,this.ele=b,this.name=c,this.values=d||{},this.data=e||{};let f=`${this.name} - `;for(const g in this.values){const a=this.values[g];a&&(f+=`${a} - `)}this.searchText=f.toLowerCase(),this._isSelected=!1}set isSelected(a){this._isSelected===a||(this._isSelected=a,this.ele instanceof $?this._isSelected?this.ele.addClass("list-multi-selected"):this.ele.removeClass("list-multi-selected"):this._isSelected?this.ele.classList.add("list-multi-selected"):this.ele.classList.remove("list-multi-selected"))}get isSelected(){return this._isSelected}}class List{constructor(a){this._$iptSearch=a.$iptSearch,this._$wrpList=a.$wrpList,this._fnSort=a.fnSort===void 0?SortUtil.listSort:a.fnSort,this._items=[],this._eventHandlers={},this._searchTerm=List._DEFAULTS.searchTerm,this._sortBy=a.sortByInitial||List._DEFAULTS.sortBy,this._sortDir=a.sortDirInitial||List._DEFAULTS.sortDir,this._fnFilter=null,this._isUseJquery=a.isUseJquery,this._searchedItems=[],this._filteredSortedItems=[],this._isInit=!1,this._isDirty=!1,this._prevList=null,this._nextList=null,this._lastSelection=null,this._isMultiSelection=!1}get items(){return this._items}get visibleItems(){return this._filteredSortedItems}get sortBy(){return this._sortBy}get sortDir(){return this._sortDir}set nextList(a){this._nextList=a}set prevList(a){this._prevList=a}init(){this._isInit||(this._$iptSearch&&(SearchWidget.bindTypingEnd({$iptSearch:this._$iptSearch,fnKeyup:()=>this.search(this._$iptSearch.val())}),this._searchTerm=List._getCleanSearchTerm(this._$iptSearch.val())),this._doSearch(),this._isInit=!0)}update(){this._isInit&&this._isDirty&&this._doSearch()}_doSearch(){this._searchedItems=this._searchTerm?this._items.filter(a=>a.searchText.includes(this._searchTerm)):[...this._items],this._searchedItems=this._searchedItems.filter(a=>!a.data.isExcluded),this._doFilter()}_doFilter(){this._filteredSortedItems=this._fnFilter?this._searchedItems.filter(a=>this._fnFilter(a)):this._searchedItems,this._doSort()}_doSort(){const c={sortBy:this._sortBy};this._fnSort&&this._filteredSortedItems.sort((d,a)=>this._fnSort(d,a,c)),"desc"===this._sortDir&&this._filteredSortedItems.reverse(),this._doRender()}_doRender(){const a=this._filteredSortedItems.length;if(this._isUseJquery){this._$wrpList.children().detach();for(let b=0;b<a;++b)this._$wrpList.append(this._filteredSortedItems[b].ele)}else{this._$wrpList.empty();const b=document.createDocumentFragment();for(let c=0;c<a;++c)b.appendChild(this._filteredSortedItems[c].ele);this._$wrpList[0].appendChild(b)}this._isDirty=!1,this._trigger("updated")}search(a){const b=List._getCleanSearchTerm(a);b!==this._searchTerm&&(this._searchTerm=b,this._doSearch())}filter(a){this._fnFilter!==a&&(this._fnFilter=a,this._doFilter())}sort(a,b){(this._sortBy!==a||this._sortDir!==b)&&(this._sortBy=a,this._sortDir=b,this._doSort())}reset(){this._searchTerm===List._DEFAULTS.searchTerm?(this._sortBy!==List._DEFAULTS.sortBy||this._sortDir!==List._DEFAULTS.sortDir)&&(this._sortBy=List._DEFAULTS.sortBy,this._sortDir=List._DEFAULTS.sortDir):(this._searchTerm=List._DEFAULTS.searchTerm,this._doSearch())}addItem(a){this._isDirty=!0,this._items.push(a)}removeItem(a){const b=this._items.findIndex(b=>b.ix===a);~b&&(this._isDirty=!0,this._items.splice(b,1))}removeItemBy(a,b){const c=this._items.findIndex(c=>c.values[a]===b);~c&&(this._isDirty=!0,this._items.splice(c,1))}removeItemByData(a,b){const c=this._items.findIndex(c=>c.data[a]===b);~c&&(this._isDirty=!0,this._items.splice(c,1))}removeAllItems(){this._isDirty=!0,this._items=[]}on(a,b){(this._eventHandlers[a]=this._eventHandlers[a]||[]).push(b)}_trigger(a){(this._eventHandlers[a]||[]).forEach(a=>a())}doAbsorbItems(a,b){const c=this._$wrpList[0].childNodes,d=[],e=c.length;for(let f=0;f<e;++f)c[f].nodeType!==Node.TEXT_NODE&&d.push(c[f]);const f=d.length;if(f!==a.length)throw new Error(`Data source length and list element length did not match!`);for(let c=0;c<f;++c){const e=d[c],f=a[c],g=new ListItem(c,e,b.fnGetName(f),b.fnGetValues?b.fnGetValues(f):{},{});b.fnGetData&&(g.data=b.fnGetData(g,f)),b.fnBindListeners&&b.fnBindListeners(g,f),this.addItem(g)}}doSelect(a,b){b&&b.shiftKey?(b.preventDefault(),this._prevList&&this._prevList._lastSelection?(this._prevList._selectFromItemToEnd(this._prevList._lastSelection,!0),this._selectToItemFromStart(a)):this._nextList&&this._nextList._lastSelection?(this._nextList._selectToItemFromStart(this._nextList._lastSelection,!0),this._selectFromItemToEnd(a)):this._lastSelection&&this.visibleItems.includes(a)?this._doSelect_doMulti(a):this._doSelect_doSingle(a)):this._doSelect_doSingle(a)}_doSelect_doSingle(a){this._isMultiSelection?(this.deselectAll(),this._prevList&&this._prevList.deselectAll(),this._nextList&&this._nextList.deselectAll()):this._lastSelection&&(this._lastSelection.isSelected=!1),a.isSelected=!0,this._lastSelection=a}_doSelect_doMulti(a){this._selectFromItemToItem(this._lastSelection,a),this._prevList&&this._prevList._isMultiSelection&&this._prevList.deselectAll(),this._nextList&&this._nextList._isMultiSelection&&this._nextList.deselectAll()}_selectFromItemToEnd(a,b=!1){this.deselectAll(b),this._isMultiSelection=!0;const c=this.visibleItems.indexOf(a),d=this.visibleItems.length;for(let e=c;e<d;++e)this.visibleItems[e].isSelected=!0}_selectToItemFromStart(a,b=!1){this.deselectAll(b),this._isMultiSelection=!0;const c=this.visibleItems.indexOf(a);for(let d=0;d<=c;++d)this.visibleItems[d].isSelected=!0}_selectFromItemToItem(a,b){if(this.deselectAll(!0),a===b)return this._lastSelection&&(this._lastSelection.isSelected=!1),a.isSelected=!0,void(this._lastSelection=a);const c=this.visibleItems.indexOf(a),d=this.visibleItems.indexOf(b);this._isMultiSelection=!0;const[e,f]=[c,d].sort(SortUtil.ascSort);for(let c=e;c<=f;++c)this.visibleItems[c].isSelected=!0}deselectAll(a=!1){a||(this._lastSelection=null),this._isMultiSelection=!1,this._items.forEach(a=>a.isSelected=!1)}updateSelected(a){this.visibleItems.includes(a)?this._isMultiSelection?this.deselectAll(!0):this._lastSelection?this._lastSelection!==a&&(this._lastSelection.isSelected=!1,a.isSelected=!0,this._lastSelection=a):(a.isSelected=!0,this._lastSelection=a):this.deselectAll()}getSelected(){return this.visibleItems.filter(a=>a.isSelected)}static _getCleanSearchTerm(a){return(a||"").trim().toLowerCase().split(/\s+/g).join(" ")}}List._DEFAULTS={searchTerm:"",sortBy:"name",sortDir:"asc",fnFilter:null},"undefined"!=typeof module&&(module.exports={List,ListItem});